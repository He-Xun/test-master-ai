<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 10px; padding: 10px 20px; }
        .success { background: #52c41a; color: white; }
        .error { background: #ff4d4f; color: white; }
        pre { background: #f5f5f5; padding: 15px; overflow: auto; }
    </style>
</head>
<body>
    <h1>å¿«é€Ÿæµ‹è¯• - æ•°æ®ä¿å­˜å’Œè¯»å–</h1>
    
    <div>
        <button onclick="createTestData()">1. åˆ›å»ºæµ‹è¯•æ•°æ®</button>
        <button onclick="readData()">2. è¯»å–æ•°æ®</button>
        <button onclick="testStorageFunctions()">3. æµ‹è¯•å­˜å‚¨å‡½æ•°</button>
        <button onclick="clearData()">4. æ¸…ç©ºæ•°æ®</button>
    </div>
    
    <div id="result"></div>
    
    <script>
        function log(message, type = 'info') {
            const div = document.getElementById('result');
            const p = document.createElement('p');
            p.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            p.className = type;
            div.appendChild(p);
            console.log(message);
        }
        
        function createTestData() {
            log('å¼€å§‹åˆ›å»ºæµ‹è¯•æ•°æ®...');
            
            try {
                // åˆ›å»ºæç¤ºè¯
                const prompt = {
                    id: 'test-prompt-' + Date.now(),
                    name: 'æµ‹è¯•æç¤ºè¯',
                    content: 'ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹ã€‚',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                const prompts = JSON.parse(localStorage.getItem('prompts') || '[]');
                prompts.push(prompt);
                localStorage.setItem('prompts', JSON.stringify(prompts));
                log(`âœ… åˆ›å»ºæç¤ºè¯æˆåŠŸ: ${prompt.name}`, 'success');
                
                // åˆ›å»ºAPIé…ç½®
                const apiConfig = {
                    id: 'test-config-' + Date.now(),
                    name: 'æµ‹è¯•APIé…ç½®',
                    requestMode: 'url',
                    directUrl: 'http://127.0.0.1:8008/req',
                    models: [
                        {
                            id: 'model-1',
                            name: 'gpt-4o',
                            displayName: 'GPT-4o',
                            enabled: true
                        }
                    ],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                const apiConfigs = JSON.parse(localStorage.getItem('apiConfigs') || '[]');
                apiConfigs.push(apiConfig);
                localStorage.setItem('apiConfigs', JSON.stringify(apiConfigs));
                log(`âœ… åˆ›å»ºAPIé…ç½®æˆåŠŸ: ${apiConfig.name}`, 'success');
                
                // åˆ›å»ºé»˜è®¤æµ‹è¯•è¾“å…¥
                const defaultInput = {
                    id: 'test-input-' + Date.now(),
                    name: 'æµ‹è¯•è¾“å…¥',
                    content: 'ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±ã€‚',
                    category: 'åŸºç¡€æµ‹è¯•',
                    createdAt: new Date().toISOString()
                };
                
                const defaultInputs = JSON.parse(localStorage.getItem('defaultTestInputs') || '[]');
                defaultInputs.push(defaultInput);
                localStorage.setItem('defaultTestInputs', JSON.stringify(defaultInputs));
                log(`âœ… åˆ›å»ºé»˜è®¤è¾“å…¥æˆåŠŸ: ${defaultInput.name}`, 'success');
                
                log('âœ… æ‰€æœ‰æµ‹è¯•æ•°æ®åˆ›å»ºå®Œæˆï¼', 'success');
                
            } catch (error) {
                log(`âŒ åˆ›å»ºæµ‹è¯•æ•°æ®å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function readData() {
            log('å¼€å§‹è¯»å–æ•°æ®...');
            
            try {
                const prompts = JSON.parse(localStorage.getItem('prompts') || '[]');
                const apiConfigs = JSON.parse(localStorage.getItem('apiConfigs') || '[]');
                const defaultInputs = JSON.parse(localStorage.getItem('defaultTestInputs') || '[]');
                
                log(`ğŸ“Š æç¤ºè¯æ•°é‡: ${prompts.length}`);
                log(`ğŸ“Š APIé…ç½®æ•°é‡: ${apiConfigs.length}`);
                log(`ğŸ“Š é»˜è®¤è¾“å…¥æ•°é‡: ${defaultInputs.length}`);
                
                // è®¡ç®—å¯ç”¨æ¨¡å‹
                let modelCount = 0;
                apiConfigs.forEach(config => {
                    if (config.models) {
                        modelCount += config.models.filter(m => m.enabled).length;
                    }
                });
                log(`ğŸ“Š å¯ç”¨æ¨¡å‹æ•°é‡: ${modelCount}`);
                
                // æ˜¾ç¤ºè¯¦ç»†æ•°æ®
                const data = {
                    prompts: prompts.map(p => ({ id: p.id, name: p.name })),
                    apiConfigs: apiConfigs.map(c => ({ 
                        id: c.id, 
                        name: c.name, 
                        modelCount: c.models ? c.models.length : 0 
                    })),
                    defaultInputs: defaultInputs.map(d => ({ id: d.id, name: d.name }))
                };
                
                const pre = document.createElement('pre');
                pre.textContent = JSON.stringify(data, null, 2);
                document.getElementById('result').appendChild(pre);
                
                if (prompts.length > 0 && modelCount > 0) {
                    log('âœ… æ•°æ®è¯»å–æˆåŠŸï¼ŒTestingPanelåº”è¯¥èƒ½æ­£å¸¸å·¥ä½œï¼', 'success');
                } else {
                    log('âš ï¸ æ•°æ®ä¸å®Œæ•´ï¼ŒTestingPanelå¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œ', 'error');
                }
                
            } catch (error) {
                log(`âŒ è¯»å–æ•°æ®å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testStorageFunctions() {
            log('å¼€å§‹æµ‹è¯•å­˜å‚¨å‡½æ•°...');
            
            try {
                // æ¨¡æ‹Ÿstorage-simple.tsä¸­çš„å‡½æ•°
                const promptStorage = {
                    getAll: () => JSON.parse(localStorage.getItem('prompts') || '[]')
                };
                
                const apiConfigStorage = {
                    getAll: () => JSON.parse(localStorage.getItem('apiConfigs') || '[]'),
                    getAllModels: () => {
                        const configs = JSON.parse(localStorage.getItem('apiConfigs') || '[]');
                        const models = [];
                        configs.forEach(config => {
                            if (config.models && Array.isArray(config.models)) {
                                config.models.forEach(model => {
                                    if (model.enabled) {
                                        models.push({
                                            id: `${config.id}_${model.id}`,
                                            name: model.name,
                                            displayName: model.displayName,
                                            apiConfigName: config.name,
                                        });
                                    }
                                });
                            }
                        });
                        return models;
                    }
                };
                
                const defaultTestInputStorage = {
                    getAll: () => JSON.parse(localStorage.getItem('defaultTestInputs') || '[]')
                };
                
                // æµ‹è¯•å‡½æ•°è°ƒç”¨
                const prompts = promptStorage.getAll();
                const models = apiConfigStorage.getAllModels();
                const defaultInputs = defaultTestInputStorage.getAll();
                
                log(`ğŸ”§ promptStorage.getAll(): ${prompts.length} ä¸ª`);
                log(`ğŸ”§ apiConfigStorage.getAllModels(): ${models.length} ä¸ª`);
                log(`ğŸ”§ defaultTestInputStorage.getAll(): ${defaultInputs.length} ä¸ª`);
                
                if (prompts.length > 0 && models.length > 0) {
                    log('âœ… å­˜å‚¨å‡½æ•°æµ‹è¯•é€šè¿‡ï¼', 'success');
                } else {
                    log('âŒ å­˜å‚¨å‡½æ•°æµ‹è¯•å¤±è´¥ï¼Œæ•°æ®ä¸è¶³', 'error');
                }
                
            } catch (error) {
                log(`âŒ å­˜å‚¨å‡½æ•°æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function clearData() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                localStorage.removeItem('prompts');
                localStorage.removeItem('apiConfigs');
                localStorage.removeItem('models');
                localStorage.removeItem('defaultTestInputs');
                log('ğŸ§¹ æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'success');
                document.getElementById('result').innerHTML = '';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¯»å–æ•°æ®
        window.onload = function() {
            log('ğŸš€ å¿«é€Ÿæµ‹è¯•å·¥å…·å·²å¯åŠ¨');
            readData();
        };
    </script>
</body>
</html> 