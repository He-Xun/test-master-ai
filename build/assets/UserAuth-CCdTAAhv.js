import{r as t,I as y,_ as w,ao as e,aB as A,aV as j,ar as z,az as O,aW as n,an as o}from"./index-CFiG4jUx.js";import{F as a}from"./index-C-rmEvZ_.js";import{I as c}from"./index-BIFbDk8c.js";import{R as v}from"./UserOutlined-aohfDy2V.js";import{A as P}from"./index-C-L4OT4O.js";import"./useBreakpoint-BeMf8Kwx.js";var $={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M521.7 82c-152.5-.4-286.7 78.5-363.4 197.7-3.4 5.3.4 12.3 6.7 12.3h70.3c4.8 0 9.3-2.1 12.3-5.8 7-8.5 14.5-16.7 22.4-24.5 32.6-32.5 70.5-58.1 112.7-75.9 43.6-18.4 90-27.8 137.9-27.8 47.9 0 94.3 9.3 137.9 27.8 42.2 17.8 80.1 43.4 112.7 75.9 32.6 32.5 58.1 70.4 76 112.5C865.7 417.8 875 464.1 875 512c0 47.9-9.4 94.2-27.8 137.8-17.8 42.1-43.4 80-76 112.5s-70.5 58.1-112.7 75.9A352.8 352.8 0 01520.6 866c-47.9 0-94.3-9.4-137.9-27.8A353.84 353.84 0 01270 762.3c-7.9-7.9-15.3-16.1-22.4-24.5-3-3.7-7.6-5.8-12.3-5.8H165c-6.3 0-10.2 7-6.7 12.3C234.9 863.2 368.5 942 520.6 942c236.2 0 428-190.1 430.4-425.6C953.4 277.1 761.3 82.6 521.7 82zM395.02 624v-76h-314c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h314v-76c0-6.7 7.8-10.5 13-6.3l141.9 112a8 8 0 010 12.6l-141.9 112c-5.2 4.1-13 .4-13-6.3z"}}]},name:"login",theme:"outlined"},S=function(r,i){return t.createElement(y,w({},r,{ref:i,icon:$}))},q=t.forwardRef(S),L={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 110.8V792H136V270.8l-27.6-21.5 39.3-50.5 42.8 33.3h643.1l42.8-33.3 39.3 50.5-27.7 21.5zM833.6 232L512 482 190.4 232l-42.8-33.3-39.3 50.5 27.6 21.5 341.6 265.6a55.99 55.99 0 0068.7 0L888 270.8l27.6-21.5-39.3-50.5-42.7 33.2z"}}]},name:"mail",theme:"outlined"},H=function(r,i){return t.createElement(y,w({},r,{ref:i,icon:L}))},V=t.forwardRef(H),_={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"},T=function(r,i){return t.createElement(y,w({},r,{ref:i,icon:_}))},k=t.forwardRef(T);const{TabPane:F}=A,J=({visible:l=!0,onClose:r,onLogin:i,defaultTab:m="login",inline:g=!1})=>{const[d]=a.useForm(),[u]=a.useForm(),[N,p]=t.useState(m),[b,x]=t.useState(!1);t.useEffect(()=>{(l||g)&&p(m)},[m,l,g]);const M=async()=>{try{x(!0);const s=await d.validateFields(),h=n.login(s.username,s.password);h?(o.success("登录成功！"),i(h.user),r==null||r(),d.resetFields()):o.error("用户名或密码错误")}catch(s){console.error("登录失败:",s)}finally{x(!1)}},R=async()=>{try{x(!0);const s=await u.validateFields();if(n.getUserByUsername(s.username)){o.error("用户名已存在");return}if(n.getUserByEmail(s.email)){o.error("邮箱已被注册");return}const E=n.createUser({username:s.username,email:s.email});n.storeUserPassword(E.id,s.password);const B=n.login(s.username,s.password);B&&(o.success("注册成功并已自动登录！"),i(B.user),r==null||r(),u.resetFields())}catch(s){console.error("注册失败:",s)}finally{x(!1)}},U=()=>{r==null||r(),d.resetFields(),u.resetFields(),p(m)},I=e.jsx("div",{children:e.jsxs(A,{activeKey:N,onChange:p,centered:!0,size:"small",children:[e.jsx(F,{tab:e.jsxs("span",{className:"text-sm",children:[e.jsx(q,{}),"登录"]}),children:e.jsxs(a,{form:d,layout:"vertical",onFinish:M,size:"middle",children:[e.jsx(a.Item,{name:"username",label:"用户名",rules:[{required:!0,message:"请输入用户名"}],style:{marginBottom:16},children:e.jsx(c,{prefix:e.jsx(v,{className:"text-gray-400"}),placeholder:"请输入用户名"})}),e.jsx(a.Item,{name:"password",label:"密码",rules:[{required:!0,message:"请输入密码"}],style:{marginBottom:20},children:e.jsx(c.Password,{prefix:e.jsx(j,{className:"text-gray-400"}),placeholder:"请输入密码"})}),e.jsx(a.Item,{style:{marginBottom:0},children:e.jsx(z,{type:"primary",htmlType:"submit",loading:b,block:!0,className:"bg-blue-500 hover:bg-blue-600 h-10",children:"登录"})})]})},"login"),e.jsx(F,{tab:e.jsxs("span",{className:"text-sm",children:[e.jsx(k,{}),"注册"]}),children:e.jsxs(a,{form:u,layout:"vertical",onFinish:R,size:"middle",children:[e.jsx(a.Item,{name:"username",label:"用户名",rules:[{required:!0,message:"请输入用户名"},{min:3,message:"用户名至少3个字符"},{max:20,message:"用户名最多20个字符"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"用户名只能包含字母、数字、下划线和横线"}],style:{marginBottom:16},children:e.jsx(c,{prefix:e.jsx(v,{className:"text-gray-400"}),placeholder:"请输入用户名"})}),e.jsx(a.Item,{name:"email",label:"邮箱",rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入有效的邮箱地址"}],style:{marginBottom:16},children:e.jsx(c,{prefix:e.jsx(V,{className:"text-gray-400"}),placeholder:"请输入邮箱"})}),e.jsx(a.Item,{name:"password",label:"密码",rules:[{required:!0,message:"请输入密码"},{min:6,message:"密码至少6个字符"}],style:{marginBottom:16},children:e.jsx(c.Password,{prefix:e.jsx(j,{className:"text-gray-400"}),placeholder:"请输入密码"})}),e.jsx(a.Item,{name:"confirmPassword",label:"确认密码",dependencies:["password"],rules:[{required:!0,message:"请确认密码"},({getFieldValue:s})=>({validator(h,f){return!f||s("password")===f?Promise.resolve():Promise.reject(new Error("两次输入的密码不一致"))}})],style:{marginBottom:20},children:e.jsx(c.Password,{prefix:e.jsx(j,{className:"text-gray-400"}),placeholder:"请再次输入密码"})}),e.jsx(a.Item,{style:{marginBottom:0},children:e.jsx(z,{type:"primary",htmlType:"submit",loading:b,block:!0,className:"bg-green-500 hover:bg-green-600 h-10",children:"注册"})})]})},"register")]})});return g?I:e.jsxs(O,{title:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(v,{className:"text-blue-500"}),e.jsx("span",{children:"用户认证"})]}),open:l,onCancel:U,footer:null,width:420,centered:!0,bodyStyle:{maxHeight:"80vh",overflowY:"auto",padding:"16px 24px 24px 24px"},style:{top:20},children:[e.jsx(P,{message:"数据隔离保护",description:"注册后您的配置将会独立保存，不同用户之间的数据相互隔离。",type:"info",showIcon:!0,className:"mb-4",style:{fontSize:"12px"}}),I]})};export{J as default};
