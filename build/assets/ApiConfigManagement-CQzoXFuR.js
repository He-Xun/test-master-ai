import{r as h,I as $e,_ as pe,B as ke,aC as xe,x as Ne,f as fe,v as ae,aD as se,g as Ae,m as qe,a as Ee,u as L,b as ze,L as Te,d as De,a2 as Re,a1 as Le,aE as Pe,aF as Fe,ah as Oe,al as _,ao as e,aw as V,ar as $,aG as Ke,ay as Ue,ax as J,at as te,az as He,aB as Z,ap as ie,aH as le,aI as Ve,aJ as ce,aK as oe,R as re,aL as Be,an as w}from"./index-CFiG4jUx.js";import{t as We,f as _e}from"./api-BgJXedR7.js";import{F as k}from"./index-C-rmEvZ_.js";import{S as P,R as de}from"./index-BXFIHTMJ.js";import{T as me}from"./index-BtKM4wLR.js";import{a as Ge,F as Xe,R as Y,C as Qe}from"./Table-BajktlNK.js";import{I as F}from"./index-BIFbDk8c.js";import{R as ue}from"./InfoCircleOutlined-CJJ1fdZK.js";import{R as Je}from"./ReloadOutlined-36gt7DSb.js";import{C as Ye}from"./Collapse-KgqCS7jy.js";import"./useBreakpoint-BeMf8Kwx.js";var Ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"},en=function(t,d){return h.createElement($e,pe({},t,{ref:d,icon:Ze}))},ge=h.forwardRef(en),nn=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],be=h.forwardRef(function(n,t){var d,r=n.prefixCls,m=r===void 0?"rc-switch":r,p=n.className,x=n.checked,l=n.defaultChecked,o=n.disabled,u=n.loadingIcon,b=n.checkedChildren,I=n.unCheckedChildren,A=n.onClick,C=n.onChange,q=n.onKeyDown,O=ke(n,nn),U=xe(!1,{value:x,defaultValue:l}),j=Ne(U,2),z=j[0],y=j[1];function f(M,K){var R=z;return o||(R=M,y(R),C==null||C(R,K)),R}function S(M){M.which===se.LEFT?f(!1,M):M.which===se.RIGHT&&f(!0,M),q==null||q(M)}function N(M){var K=f(!z,M);A==null||A(K,M)}var D=fe(m,p,(d={},ae(d,"".concat(m,"-checked"),z),ae(d,"".concat(m,"-disabled"),o),d));return h.createElement("button",pe({},O,{type:"button",role:"switch","aria-checked":z,disabled:o,className:D,ref:t,onKeyDown:S,onClick:N}),u,h.createElement("span",{className:"".concat(m,"-inner")},h.createElement("span",{className:"".concat(m,"-inner-checked")},b),h.createElement("span",{className:"".concat(m,"-inner-unchecked")},I)))});be.displayName="Switch";const an=n=>{const{componentCls:t,trackHeightSM:d,trackPadding:r,trackMinWidthSM:m,innerMinMarginSM:p,innerMaxMarginSM:x,handleSizeSM:l,calc:o}=n,u=`${t}-inner`,b=L(o(l).add(o(r).mul(2)).equal()),I=L(o(x).mul(2).equal());return{[t]:{[`&${t}-small`]:{minWidth:m,height:d,lineHeight:L(d),[`${t}-inner`]:{paddingInlineStart:x,paddingInlineEnd:p,[`${u}-checked, ${u}-unchecked`]:{minHeight:d},[`${u}-checked`]:{marginInlineStart:`calc(-100% + ${b} - ${I})`,marginInlineEnd:`calc(100% - ${b} + ${I})`},[`${u}-unchecked`]:{marginTop:o(d).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${t}-handle`]:{width:l,height:l},[`${t}-loading-icon`]:{top:o(o(l).sub(n.switchLoadingIconSize)).div(2).equal(),fontSize:n.switchLoadingIconSize},[`&${t}-checked`]:{[`${t}-inner`]:{paddingInlineStart:p,paddingInlineEnd:x,[`${u}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${u}-unchecked`]:{marginInlineStart:`calc(100% - ${b} + ${I})`,marginInlineEnd:`calc(-100% + ${b} - ${I})`}},[`${t}-handle`]:{insetInlineStart:`calc(100% - ${L(o(l).add(r).equal())})`}},[`&:not(${t}-disabled):active`]:{[`&:not(${t}-checked) ${u}`]:{[`${u}-unchecked`]:{marginInlineStart:o(n.marginXXS).div(2).equal(),marginInlineEnd:o(n.marginXXS).mul(-1).div(2).equal()}},[`&${t}-checked ${u}`]:{[`${u}-checked`]:{marginInlineStart:o(n.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:o(n.marginXXS).div(2).equal()}}}}}}},sn=n=>{const{componentCls:t,handleSize:d,calc:r}=n;return{[t]:{[`${t}-loading-icon${n.iconCls}`]:{position:"relative",top:r(r(d).sub(n.fontSize)).div(2).equal(),color:n.switchLoadingIconColor,verticalAlign:"top"},[`&${t}-checked ${t}-loading-icon`]:{color:n.switchColor}}}},tn=n=>{const{componentCls:t,trackPadding:d,handleBg:r,handleShadow:m,handleSize:p,calc:x}=n,l=`${t}-handle`;return{[t]:{[l]:{position:"absolute",top:d,insetInlineStart:d,width:p,height:p,transition:`all ${n.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:r,borderRadius:x(p).div(2).equal(),boxShadow:m,transition:`all ${n.switchDuration} ease-in-out`,content:'""'}},[`&${t}-checked ${l}`]:{insetInlineStart:`calc(100% - ${L(x(p).add(d).equal())})`},[`&:not(${t}-disabled):active`]:{[`${l}::before`]:{insetInlineEnd:n.switchHandleActiveInset,insetInlineStart:0},[`&${t}-checked ${l}::before`]:{insetInlineEnd:0,insetInlineStart:n.switchHandleActiveInset}}}}},ln=n=>{const{componentCls:t,trackHeight:d,trackPadding:r,innerMinMargin:m,innerMaxMargin:p,handleSize:x,calc:l}=n,o=`${t}-inner`,u=L(l(x).add(l(r).mul(2)).equal()),b=L(l(p).mul(2).equal());return{[t]:{[o]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:p,paddingInlineEnd:m,transition:`padding-inline-start ${n.switchDuration} ease-in-out, padding-inline-end ${n.switchDuration} ease-in-out`,[`${o}-checked, ${o}-unchecked`]:{display:"block",color:n.colorTextLightSolid,fontSize:n.fontSizeSM,transition:`margin-inline-start ${n.switchDuration} ease-in-out, margin-inline-end ${n.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:d},[`${o}-checked`]:{marginInlineStart:`calc(-100% + ${u} - ${b})`,marginInlineEnd:`calc(100% - ${u} + ${b})`},[`${o}-unchecked`]:{marginTop:l(d).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${t}-checked ${o}`]:{paddingInlineStart:m,paddingInlineEnd:p,[`${o}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${o}-unchecked`]:{marginInlineStart:`calc(100% - ${u} + ${b})`,marginInlineEnd:`calc(-100% + ${u} - ${b})`}},[`&:not(${t}-disabled):active`]:{[`&:not(${t}-checked) ${o}`]:{[`${o}-unchecked`]:{marginInlineStart:l(r).mul(2).equal(),marginInlineEnd:l(r).mul(-1).mul(2).equal()}},[`&${t}-checked ${o}`]:{[`${o}-checked`]:{marginInlineStart:l(r).mul(-1).mul(2).equal(),marginInlineEnd:l(r).mul(2).equal()}}}}}},cn=n=>{const{componentCls:t,trackHeight:d,trackMinWidth:r}=n;return{[t]:Object.assign(Object.assign(Object.assign(Object.assign({},Ee(n)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:r,height:d,lineHeight:L(d),verticalAlign:"middle",background:n.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${n.motionDurationMid}`,userSelect:"none",[`&:hover:not(${t}-disabled)`]:{background:n.colorTextTertiary}}),ze(n)),{[`&${t}-checked`]:{background:n.switchColor,[`&:hover:not(${t}-disabled)`]:{background:n.colorPrimaryHover}},[`&${t}-loading, &${t}-disabled`]:{cursor:"not-allowed",opacity:n.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${t}-rtl`]:{direction:"rtl"}})}},on=n=>{const{fontSize:t,lineHeight:d,controlHeight:r,colorWhite:m}=n,p=t*d,x=r/2,l=2,o=p-l*2,u=x-l*2;return{trackHeight:p,trackHeightSM:x,trackMinWidth:o*2+l*4,trackMinWidthSM:u*2+l*2,trackPadding:l,handleBg:m,handleSize:o,handleSizeSM:u,handleShadow:`0 2px 4px 0 ${new Te("#00230b").setA(.2).toRgbString()}`,innerMinMargin:o/2,innerMaxMargin:o+l+l*2,innerMinMarginSM:u/2,innerMaxMarginSM:u+l+l*2}},rn=Ae("Switch",n=>{const t=qe(n,{switchDuration:n.motionDurationMid,switchColor:n.colorPrimary,switchDisabledOpacity:n.opacityLoading,switchLoadingIconSize:n.calc(n.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${n.opacityLoading})`,switchHandleActiveInset:"-30%"});return[cn(t),ln(t),tn(t),sn(t),an(t)]},on);var dn=function(n,t){var d={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(d[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,r=Object.getOwnPropertySymbols(n);m<r.length;m++)t.indexOf(r[m])<0&&Object.prototype.propertyIsEnumerable.call(n,r[m])&&(d[r[m]]=n[r[m]]);return d};const mn=h.forwardRef((n,t)=>{const{prefixCls:d,size:r,disabled:m,loading:p,className:x,rootClassName:l,style:o,checked:u,value:b,defaultChecked:I,defaultValue:A,onChange:C}=n,q=dn(n,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[O,U]=xe(!1,{value:u??b,defaultValue:I??A}),{getPrefixCls:j,direction:z,switch:y}=h.useContext(De),f=h.useContext(Re),S=(m??f)||p,N=j("switch",d),D=h.createElement("div",{className:`${N}-handle`},p&&h.createElement(Fe,{className:`${N}-loading-icon`})),[M,K,R]=rn(N),G=Le(r),H=fe(y==null?void 0:y.className,{[`${N}-small`]:G==="small",[`${N}-loading`]:p,[`${N}-rtl`]:z==="rtl"},x,l,K,R),B=Object.assign(Object.assign({},y==null?void 0:y.style),o),X=(...W)=>{U(W[0]),C==null||C.apply(void 0,W)};return M(h.createElement(Pe,{component:"Switch"},h.createElement(be,Object.assign({},q,{checked:O,onChange:X,prefixCls:N,className:H,style:B,disabled:S,ref:t,loadingIcon:D}))))}),Ce=mn;Ce.__ANT_SWITCH=!0;const{Panel:vn}=Ye,{TabPane:he}=Z,Mn=()=>{const{t:n}=Oe(),[t,d]=h.useState([]),[r,m]=h.useState(!1),[p,x]=h.useState(null),[l]=k.useForm(),[o,u]=h.useState(null),[b,I]=h.useState(!1),[A,C]=h.useState([]),[q,O]=h.useState({}),[U,j]=h.useState(!1),[z,y]=h.useState(""),[f,S]=h.useState([]),[N,D]=h.useState("basic"),M=h.useRef(null),[K,R]=h.useState(null),G=`
    .compact-tabs .ant-tabs-content-holder {
      padding-top: 8px !important;
    }
    .compact-tabs .ant-tabs-tabpane {
      padding: 0 !important;
    }
    .compact-tabs .ant-tabs-tab-list {
      margin-bottom: 0 !important;
    }
  `;h.useEffect(()=>{H();const a=document.createElement("style");return a.textContent=G,document.head.appendChild(a),()=>{document.head.contains(a)&&document.head.removeChild(a)}},[]);const H=()=>{console.log("[ApiConfigManagement] 开始加载配置");const a=_.getAll();console.log("[ApiConfigManagement] 加载到的配置:",a),d(a)},B=()=>{x(null),l.resetFields(),l.setFieldsValue({requestMode:"api",models:[{id:"model-1",modelId:"gpt-4o",name:"GPT-4o",enabled:!0}]}),C([]),j(!1),S([]),y(""),D("basic"),m(!0)},X=a=>{x(a),console.log("[ApiConfigManagement] 编辑配置:",a),console.log("[ApiConfigManagement] requestMode值:",a.requestMode);const s={...a,models:a.models.length>0?a.models:[{id:"model-1",modelId:"gpt-4o",name:"GPT-4o",enabled:!0}]};if(console.log("[ApiConfigManagement] 设置表单值:",s),l.setFieldsValue(s),a.requestMode==="api"&&a.baseUrl&&a.apiKey){const i=`${a.baseUrl}_${a.apiKey.substring(0,10)}`;q[i]?(C(q[i]),j(!0)):(C([]),j(!1))}else C([]),j(!1);S([]),y(""),D("basic"),m(!0)},W=a=>{_.delete(a),H(),w.success(n("api.deleteSuccess"))},je=async a=>{u(a.id);try{await We(a)?w.success(n("api.testSuccess")):w.error(n("api.testFailed"))}catch(s){w.error(`${n("api.testFailed")}: ${s.message}`)}finally{u(null)}},ee=async()=>{const a=l.getFieldValue("baseUrl"),s=l.getFieldValue("apiKey");if(l.getFieldValue("requestMode")!=="api"){w.warning(n("api.onlyApiModeSupport"));return}if(!a||!s){w.warning(n("api.fillBaseUrlAndApiKey"));return}const c=`${a}_${s.substring(0,10)}`;if(q[c]){C(q[c]),j(!0),w.success(n("api.fetchModelsSuccess",{count:q[c].length})+" (来自缓存)");return}I(!0);try{const g={id:"temp",name:"temp",requestMode:"api",baseUrl:a,apiKey:s,models:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},E=await _e(g);O(T=>({...T,[c]:E})),C(E),j(!0),w.success(n("api.fetchModelsSuccess",{count:E.length}))}catch(g){w.error(`${n("api.fetchModelsFailed")}: ${g.message}`),console.error("获取模型失败:",g)}finally{I(!1)}},ye=a=>{console.log("[ApiConfigManagement] 开始添加选中的模型:",a);const s=A.filter(v=>a.includes(v.id));console.log("[ApiConfigManagement] 过滤后的模型数据:",s);const i=l.getFieldValue("models")||[];console.log("[ApiConfigManagement] 当前表单中的模型:",i);const c=new Set(i.map(v=>v.modelId)),g=s.filter(v=>!c.has(v.id));if(g.length===0){w.warning(n("api.modelAlreadyExists"));return}const E=g.map(v=>({id:`model-${Date.now()}-${Math.random()}`,modelId:v.id,name:v.name,enabled:!0})),T=[...i,...E];console.log("[ApiConfigManagement] 更新后的模型列表:",T),l.setFieldsValue({models:T}),l.setFields([{name:"models",value:T}]),w.success(n("api.modelsAdded",{count:g.length})),setTimeout(()=>{const v=l.getFieldValue("models");console.log("[ApiConfigManagement] 验证表单设置结果:",v),console.log("[ApiConfigManagement] 模型数量 - 添加前:",i.length,"添加后:",(v==null?void 0:v.length)||0),(!v||v.length!==T.length)&&(console.warn("[ApiConfigManagement] 表单设置可能失败，尝试重新设置"),l.setFieldsValue({models:T}))},100),S([]),j(!1)},Se=a=>{const s=a.map(g=>g.id),i=f;if(s.every(g=>i.includes(g)))S(i.filter(g=>!s.includes(g)));else{const g=Array.from(new Set([...i,...s]));S(g)}},ve=async()=>{var a;try{console.log("[ApiConfigManagement] 开始表单验证...");const s=l.getFieldsValue();console.log("[ApiConfigManagement] 表单原始数据:",s),console.log("[ApiConfigManagement] 原始模型数据:",s.models);const i=await l.validateFields();if(console.log("[ApiConfigManagement] 表单验证通过，准备保存:",i),console.log("[ApiConfigManagement] 验证后的模型数据:",i.models),console.log("[ApiConfigManagement] 模型数量:",((a=i.models)==null?void 0:a.length)||0),p){const c={...p,...i,updatedAt:new Date().toISOString()};console.log("[ApiConfigManagement] 准备更新的配置:",c),_.update(p.id,c),w.success(n("api.updateSuccess")),console.log("[ApiConfigManagement] 配置更新成功")}else{const c={...i,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};console.log("[ApiConfigManagement] 准备保存的新配置:",c),_.create(c),w.success(n("api.saveSuccess")),console.log("[ApiConfigManagement] 新配置保存成功")}window.dispatchEvent(new CustomEvent("apiConfigsUpdated")),console.log("[ApiConfigManagement] 已触发apiConfigsUpdated事件"),m(!1),x(null),l.resetFields(),H(),C([]),j(!1),S([]),y(""),D("basic")}catch(s){console.error("[ApiConfigManagement] 保存配置失败:",s),w.error(n("api.saveFailed"))}},Me=()=>{console.log("[ApiConfigManagement] 取消操作，重置所有状态"),m(!1),x(null),C([]),j(!1),S([]),y(""),D("basic"),R(null),l.resetFields()},we=a=>{const s={GPT系列:[],Claude系列:[],Qwen系列:[],DeepSeek系列:[],LLaMA系列:[],开源模型:[],其他模型:[]};return a.forEach(i=>{const c=i.name.toLowerCase(),g=i.id.toLowerCase();c.includes("gpt")||c.includes("davinci")||c.includes("babbage")||c.includes("curie")?s.GPT系列.push(i):c.includes("claude")?s.Claude系列.push(i):c.includes("qwen")||g.includes("qwen")?s.Qwen系列.push(i):c.includes("deepseek")||g.includes("deepseek")?s.DeepSeek系列.push(i):c.includes("llama")||g.includes("llama")||c.includes("yi-")||g.includes("yi-")?s.LLaMA系列.push(i):c.includes("mistral")||c.includes("chatglm")||c.includes("baichuan")||c.includes("moonshot")||c.includes("gemini")||c.includes("grok")||c.includes("internlm")||c.includes("aquila")||c.includes("falcon")?s.开源模型.push(i):s.其他模型.push(i)}),Object.keys(s).forEach(i=>{s[i].length===0&&delete s[i]}),s},Q=A.filter(a=>a.name.toLowerCase().includes(z.toLowerCase())||a.id.toLowerCase().includes(z.toLowerCase())),ne=we(Q),Ie=[{title:n("api.name"),dataIndex:"name",key:"name",render:(a,s)=>e.jsxs(P,{children:[s.requestMode==="url"?e.jsx(ge,{}):e.jsx(V,{}),e.jsx("span",{children:a})]})},{title:n("api.requestMode"),dataIndex:"requestMode",key:"requestMode",render:a=>e.jsx(me,{color:a==="url"?"blue":"green",children:n(a==="url"?"api.urlDirectRequest":"api.apiInterface")})},{title:n("api.configInfo"),key:"config",render:a=>e.jsx("div",{children:a.requestMode==="url"?e.jsx("div",{children:e.jsxs("div",{children:["URL: ",a.directUrl]})}):e.jsxs("div",{children:[e.jsxs("div",{children:["Base URL: ",a.baseUrl]}),e.jsxs("div",{children:["API Key: ",a.apiKey?n("api.configured"):n("api.notConfigured")]})]})})},{title:n("api.modelCount"),key:"modelCount",render:a=>e.jsxs(me,{color:"cyan",children:[a.models.filter(s=>s.enabled).length," / ",a.models.length]})},{title:n("common.createdAt"),dataIndex:"createdAt",key:"createdAt",render:a=>new Date(a).toLocaleString()},{title:n("common.actions"),key:"actions",render:(a,s)=>e.jsxs(P,{size:"small",children:[e.jsx($,{type:"primary",size:"small",icon:e.jsx(Ke,{}),loading:o===s.id,onClick:()=>je(s),className:"bg-green-500 hover:bg-green-600 border-green-500",children:n("api.test")}),e.jsx($,{type:"default",size:"small",icon:e.jsx(Ue,{}),onClick:()=>X(s),className:"border-blue-300 text-blue-600 hover:bg-blue-50",children:n("api.edit")}),e.jsx(Ge,{title:n("api.confirmDelete"),onConfirm:()=>W(s.id),okText:n("common.confirm"),cancelText:n("common.cancel"),children:e.jsx($,{type:"default",danger:!0,size:"small",icon:e.jsx(de,{}),className:"border-red-300 text-red-600 hover:bg-red-50",children:n("api.delete")})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-lg flex items-center justify-center",children:e.jsx(V,{className:"text-white text-xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:n("api.title")}),e.jsx("p",{className:"text-gray-500 mt-1",children:n("api.subtitle")})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.length}),e.jsx("div",{className:"text-sm text-gray-500",children:n("api.configurations")})]}),e.jsx($,{type:"primary",icon:e.jsx(J,{}),onClick:B,size:"large",className:"bg-gradient-to-r from-blue-500 to-indigo-500 border-none shadow-lg hover:shadow-xl",children:n("api.add")})]})]})}),e.jsx(te,{className:"shadow-sm border-gray-200",children:e.jsx(Xe,{columns:Ie,dataSource:t,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(a,s)=>n("common.pagination",{start:s[0],end:s[1],total:a})},className:"custom-table",locale:{emptyText:e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(V,{className:"text-4xl text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500 mb-4",children:n("api.noConfigurations")}),e.jsx($,{type:"primary",icon:e.jsx(J,{}),onClick:B,className:"bg-gradient-to-r from-blue-500 to-indigo-500 border-none",children:n("api.createFirst")})]})}})}),e.jsx(He,{title:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{className:"text-blue-500"}),e.jsx("span",{children:n(p?"api.editConfiguration":"api.addConfiguration")})]}),open:r,onOk:ve,onCancel:Me,width:1e3,style:{top:20},bodyStyle:{maxHeight:"calc(100vh - 200px)",overflowY:"auto",padding:0},okText:n("api.save"),cancelText:n("api.cancel"),okButtonProps:{size:"large",className:"bg-gradient-to-r from-blue-500 to-indigo-500 border-none"},cancelButtonProps:{size:"large"},children:e.jsx(k,{form:l,layout:"vertical",children:e.jsxs(Z,{activeKey:N,onChange:a=>{console.log("[ApiConfigManagement] Tab切换:",N,"->",a);const s=l.getFieldsValue();console.log("[ApiConfigManagement] 备份表单数据:",s),R(s),D(a),setTimeout(()=>{const i=l.getFieldsValue();console.log("[ApiConfigManagement] Tab切换后的表单数据:",i),s.models&&s.models.length>0&&(!i.models||i.models.length===0?(console.log("[ApiConfigManagement] 检测到模型数据丢失，从备份恢复"),l.setFieldsValue(s)):i.models.length<s.models.length&&(console.log("[ApiConfigManagement] 检测到模型数据部分丢失，从备份恢复"),l.setFieldsValue(s)))},50)},className:"px-6 pt-4",children:[e.jsx(he,{tab:"基本配置",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(k.Item,{name:"name",label:n("api.configName"),rules:[{required:!0,message:n("api.pleaseEnterConfigName")}],children:e.jsx(F,{placeholder:n("api.pleaseEnterConfigName"),size:"large"})}),e.jsx(k.Item,{name:"requestMode",label:n("api.requestMode"),rules:[{required:!0,message:n("api.pleaseSelectRequestMode")}],children:e.jsxs(Y.Group,{size:"large",children:[e.jsx(Y.Button,{value:"url",children:e.jsxs(P,{children:[e.jsx(ge,{}),n("api.urlDirectRequest"),e.jsx(ie,{title:n("api.urlDirectRequestTooltip"),children:e.jsx(ue,{})})]})}),e.jsx(Y.Button,{value:"api",children:e.jsxs(P,{children:[e.jsx(V,{}),n("api.apiInterface"),e.jsx(ie,{title:n("api.apiInterfaceTooltip"),children:e.jsx(ue,{})})]})})]})}),e.jsx(k.Item,{noStyle:!0,shouldUpdate:(a,s)=>a.requestMode!==s.requestMode,children:({getFieldValue:a})=>a("requestMode")==="url"?e.jsx(k.Item,{name:"directUrl",label:n("api.requestUrl"),rules:[{required:!0,message:n("api.pleaseEnterRequestUrl")},{type:"url",message:n("api.pleaseEnterValidUrl")}],children:e.jsx(F,{placeholder:"http://127.0.0.1:8008/req",size:"large"})}):e.jsxs(e.Fragment,{children:[e.jsx(k.Item,{name:"baseUrl",label:n("api.baseUrl"),rules:[{required:!0,message:n("api.pleaseEnterBaseUrl")},{type:"url",message:n("api.pleaseEnterValidUrl")}],children:e.jsx(F,{placeholder:"https://api.openai.com/v1",size:"large"})}),e.jsx(k.Item,{name:"apiKey",label:n("api.apiKey"),rules:[{required:!0,message:n("api.pleaseEnterApiKey")}],children:e.jsx(F.Password,{placeholder:n("api.pleaseEnterApiKey"),size:"large"})})]})})]})},"basic"),e.jsx(he,{tab:"模型配置",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(k.Item,{noStyle:!0,shouldUpdate:(a,s)=>a.requestMode!==s.requestMode||a.baseUrl!==s.baseUrl||a.apiKey!==s.apiKey,children:({getFieldValue:a})=>{const s=a("requestMode"),i=a("baseUrl"),c=a("apiKey");return s==="api"?e.jsx("div",{className:"mb-3 p-3 bg-gray-50 rounded-md",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:"自动获取模型"}),e.jsx("p",{className:"text-xs text-gray-500",children:"从API自动获取可用模型列表"})]}),e.jsxs(P,{size:"small",children:[e.jsx($,{type:"primary",icon:e.jsx(le,{}),loading:b,onClick:ee,disabled:!i||!c,size:"small",className:"bg-gradient-to-r from-green-500 to-blue-500 border-none",children:A.length>0?"重新获取":"获取模型"}),A.length>0&&e.jsx($,{icon:e.jsx(Je,{}),onClick:()=>{const g=`${i}_${c.substring(0,10)}`;O(E=>{const T={...E};return delete T[g],T}),ee()},disabled:!i||!c||b,size:"small",children:"强制刷新"})]})]})}):null}}),U&&A.length>0&&e.jsxs(te,{title:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(P,{children:[e.jsx(le,{className:"text-green-500"}),e.jsx("span",{children:"选择要添加的模型"}),e.jsx(ce,{count:Q.length,style:{backgroundColor:"#52c41a"}})]}),e.jsx($,{type:"text",icon:e.jsx(re,{}),onClick:()=>{j(!1),S([]),y("")}})]}),className:"mb-3 border-green-200 bg-green-50",size:"small",children:[e.jsxs("div",{className:"mb-3 space-y-2",children:[e.jsx(F,{placeholder:n("api.searchModels"),prefix:e.jsx(Ve,{}),value:z,onChange:a=>y(a.target.value),size:"small",allowClear:!0}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-gray-600",children:["已选择 ",f.length," / ",Q.length," 个模型"]}),e.jsxs(P,{size:"small",children:[e.jsx($,{size:"small",onClick:()=>S([]),disabled:f.length===0,children:"清空选择"}),e.jsxs($,{type:"primary",size:"small",onClick:()=>ye(f),disabled:f.length===0,className:"bg-green-500 border-green-500",children:["添加选中 (",f.length,")"]})]})]})]}),Object.keys(ne).length>0?e.jsx(Z,{size:"small",type:"card",className:"compact-tabs",items:Object.entries(ne).map(([a,s])=>({key:a,label:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:a}),e.jsx(ce,{count:s.length,size:"small"})]}),children:e.jsxs("div",{className:"space-y-2 -mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[s.length," 个模型"]}),e.jsx($,{size:"small",type:"link",onClick:()=>Se(s),className:"h-auto p-1 text-xs",children:s.every(i=>f.includes(i.id))?"取消全选":"全选"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-2 max-h-40 overflow-y-auto",children:s.map(i=>e.jsx("div",{className:`p-2 border rounded cursor-pointer transition-all text-xs ${f.includes(i.id)?"border-green-500 bg-green-50":"border-gray-200 hover:border-green-300 hover:bg-green-25"}`,onClick:()=>{f.includes(i.id)?S(f.filter(c=>c!==i.id)):S([...f,i.id])},children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qe,{checked:f.includes(i.id),onChange:()=>{}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:i.name}),i.id!==i.name&&e.jsx("div",{className:"text-gray-500 truncate text-xs",children:i.id})]})]})},i.id))})]})}))}):e.jsx(oe,{description:n("api.noMatchingModels"),image:oe.PRESENTED_IMAGE_SIMPLE})]}),e.jsx("div",{className:"mb-2 p-3 bg-gray-50 border border-gray-200 rounded-md",children:e.jsxs("div",{className:"flex items-center gap-3 text-sm font-medium text-gray-600",children:[e.jsx("div",{className:"flex-1",children:"模型ID"}),e.jsx("div",{className:"flex-1",children:"模型名称"}),e.jsx("div",{className:"flex items-center justify-center",style:{width:"44px"},children:"启用"}),e.jsx("div",{className:"flex items-center justify-center",style:{width:"32px"},children:"操作"})]})}),e.jsx(k.List,{name:"models",children:(a,{add:s,remove:i})=>(M.current={add:s,remove:i},e.jsxs(e.Fragment,{children:[a.map(({key:c,name:g,...E})=>e.jsx("div",{className:"mb-2 p-3 border border-gray-200 rounded-md bg-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k.Item,{...E,name:[g,"modelId"],rules:[{required:!0,message:"请输入模型ID"}],className:"mb-0 flex-1",children:e.jsx(F,{placeholder:"gpt-4o"})}),e.jsx(k.Item,{...E,name:[g,"name"],rules:[{required:!0,message:"请输入模型名称"}],className:"mb-0 flex-1",children:e.jsx(F,{placeholder:"GPT-4o"})}),e.jsx(k.Item,{...E,name:[g,"enabled"],valuePropName:"checked",className:"mb-0",children:e.jsx(Ce,{size:"small",checkedChildren:e.jsx(Be,{}),unCheckedChildren:e.jsx(re,{})})}),a.length>1&&e.jsx($,{type:"text",danger:!0,size:"small",icon:e.jsx(de,{}),onClick:()=>i(g)})]})},c)),e.jsx($,{type:"dashed",onClick:()=>s({id:`model-${Date.now()}`,modelId:"",name:"",enabled:!0}),block:!0,icon:e.jsx(J,{}),size:"small",className:"border-gray-300 text-gray-600 hover:border-blue-500 hover:text-blue-500",children:"手动添加模型"})]}))})]})},"models")]})})})]})};export{Mn as default};
